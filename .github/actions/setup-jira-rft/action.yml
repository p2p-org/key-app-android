name: "Jira manipulations - READY FOR TESTING"
description: "When a feature build is uploaded to Firebase&Slack, moving the ticket number to RFT status in JIRA"
inputs:
  jira-base-url:
    description: "Jira base url"
    required: true
  jira-api-token:
    description: "Jira api token related to the jira-user-email"
    required: true

runs:
  using: composite
  steps:
    - name: "Extract JIRA key from commit message"
      shell: bash
      if: github.ref == 'refs/heads/develop'
      id: extract_jira_key
      env:
        JIRA_ISSUE_KEY: ${{ extract_jira_key(github.event.head_commit.message) }}
      run: |
        echo "JIRA Issue Key: ${{ env.JIRA_ISSUE_KEY }}"
        echo "Extracted from Commit Message: ${{ github.event.head_commit.message }}"
    - name: Update JIRA issue status
      shell: bash
      if: env.JIRA_ISSUE_KEY
      run: |
        curl -D- -H "Authorization: Basic ${{ inputs.jira-api-token }}" \
          -X PUT \
          -H "Content-Type: application/json" \
          -d '{"fields": {"status": {"name": "Ready for Testing"}}}' \
          https://${{ inputs.jira-base-url }}/rest/api/2/issue/${{ env.JIRA_ISSUE_KEY }}