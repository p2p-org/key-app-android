// example './gradlew setVersionBuild -Pversion=10'
task setVersionBuild {
    def appVersionsFile = file("${rootDir}/buildSrc/src/main/java/AppVersions.kt")
    def versionCodeProperty = "const val VERSION_BUILD ="
    def version = project.hasProperty('version') ? project.property('version') : null

    if (version == null) {
        doLast {
            println("Error: version property not defined.")
            throw new StopExecutionException()
        }
        return
    }

    doLast {
        def newContent = appVersionsFile.readLines()
                .collect { line ->
                    if (line.contains(versionCodeProperty)) {
                        "    $versionCodeProperty $version"
                    } else {
                        line
                    }
                }
                .join("\n")

        // Append a newline character to the last line
        newContent += '\n'

        appVersionsFile.write(newContent)
    }
}

// example './gradlew setLastCommitHash -Phash="somehash"'
task setLastCommitHash {
    def appVersionsFile = file("${rootDir}/buildSrc/src/main/java/LastCommit.kt")
    def versionCodeProperty = "const val COMMIT_HASH ="
    def hash = project.hasProperty('hash') ? project.property('hash') : null

    println("HHHASH: $hash")

    if (hash == null) {
        doLast {
            println("Error: hash property not defined.")
            throw new StopExecutionException()
        }
        return
    }

    doLast {
        def newContent = appVersionsFile.readLines()
                .collect { line ->
                    if (line.contains(versionCodeProperty)) {
                        "    $versionCodeProperty $hash"
                    } else {
                        line
                    }
                }
                .join("\n")

        // Append a newline character to the last line
        newContent += '\n'

        appVersionsFile.write(newContent)
    }
}